# Загрузка системы

## Цель домашнего задания:
- объяснить как происходит загрузка системы, в чем разница между BIOS/UEFI;
- настраивать GRUB2;
- управлять initrd с помощью dracut;
- работать с udev;
- восстанавливать сломанный загрузчик.

В работе использовался vagrant box: "centos/7" version "1804.02"

Описание домашнего задания:

1) Попасть в систему без пароля несколькими способами;
2) Установить систему с LVM, после чего переименовать VG;
3) Добавить модуль в initrd.

### Попасть в систему без пароля несколькими способами

Способ 1. init=/bin/sh <br/>
Во время загрузки в интерактивном меню grub нажимаем "e" для редактирования параметров загрузки. <br/>
В конце строки начинающейся с linux16 добавляем "init=/bin/sh" и меняем "ro" на "rw", нажимаем сtrl-x для <br/>
загрузки в систему.

Способ 2. rd.break <br/>
Во время загрузки в интерактивном меню grub нажимаем "e" для редактирования параметров загрузки. <br/>
В конце строки начинающейся с linux16 добавляем rd.break и меняем "ro" на "rw", нажимаем сtrl-x для загрузки в систему. <br/>
Попадаем в emergency mode и меняем пароль рута.  <br/>

```
chroot /sysroot
passwd root
touch /.autorelabel
```

Способ 3. rw init=/sysroot/bin/sh <br/>
Во время загрузки в интерактивном меню grub нажимаем "e" для редактирования параметров загрузки. <br/>
В конце строки начинающейся с linux16 добавляем init=/sysroot/bin/sh и меняем "ro" на "rw", нажимаем сtrl-x для загрузки в систему. <br/>

### Установить систему с LVM, после чего переименовать VG
Для оперативной смены названия группы можно использовать следующий код:    

    Зададим переменные:
    old_name="имя старой группы"
    new_name="имя новой группы" 
    
    vgrename -v $old_name $new_name;
    sed -i "s/\/${old_name}-/\/${new_name}-/g" /etc/fstab;
    sed -i "s/\([/=]\)${old_name}\([-/]\)/\1${new_name}\2/g" /boot/grub2/grub.cfg;
    dracut -f -v /boot/initramfs-$(uname -r).img $(uname -r);
    systemctl reboot -f;
    
### Добавить модуль в initrd
Для добавления нового модуля скачиваем необходимые скрипты с гита и переместим их в директорию с модулями. Пересоберем образ initrd, внесем правки в загрузчик.
После перезагрузки мы можем наблюдать получившийся результат (см. screenshot)

#### typescript$ содержат комментарии с описанием выполняемых команд!
